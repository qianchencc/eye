#!/bin/bash

# ================= Internationalization =================
_init_messages() {
    # Detect language
    if [[ "$LANGUAGE" == "zh" ]] || [[ "$LANGUAGE" == "Chinese" ]]; then
        LANG_MODE="zh"
    elif [[ "$LANGUAGE" == "en" ]] || [[ "$LANGUAGE" == "English" ]]; then
        LANG_MODE="en"
    elif [[ -z "$LANGUAGE" ]]; then
        if [[ "$LANG" == zh* ]]; then
            LANG_MODE="zh"
        else
            LANG_MODE="en"
        fi
    else
        LANG_MODE="en"
    fi

    if [ "$LANG_MODE" == "zh" ]; then
        # --- Chinese (Simplified) ---
        MSG_USAGE_HEADER="用法: eye <command> [args]"
        MSG_USAGE_CORE="核心命令:"
        MSG_USAGE_CMD_START="  start            启动护眼服务"
        MSG_USAGE_CMD_STOP="  stop             停止护眼服务"
        MSG_USAGE_CMD_KILL="  kill             强制停止所有进程并重置"
        MSG_USAGE_CMD_PAUSE="  pause <time>     暂停服务 (如: 1h, 30m)"
        MSG_USAGE_CMD_RESUME="  resume           恢复服务"
        MSG_USAGE_CMD_PASS="  pass <time>      跳过等待时间"
        MSG_USAGE_CMD_STATUS="  status           显示服务状态"
        MSG_USAGE_CMD_NOW="  now [--reset]    立即触发休息 (--reset 重置计时)"
        MSG_USAGE_CMD_SET="  set <gap> <look> 设置间隔与时长 (如: 20m 20s)"
        MSG_USAGE_CMD_LANG="  language <lang>  设置语言 (en/zh)"
        MSG_USAGE_CMD_AUTOSTART="  autostart [on|off] 管理开机自启"
        MSG_USAGE_AUDIO="音频管理 (eye sound ...):"
        MSG_USAGE_CMD_SOUND_LIST="  sound list              列出音效"
        MSG_USAGE_CMD_SOUND_PLAY="  sound play <tag>        试听音效"
        MSG_USAGE_CMD_SOUND_SET="  sound set <start> <end> 设置提示音"
        MSG_USAGE_CMD_SOUND_ADD="  sound add <tag> <path>  添加自定义音效"
        MSG_USAGE_CMD_SOUND_RM="  sound rm  <tag>         删除自定义音效"
        MSG_USAGE_CMD_SOUND_SWITCH="  sound on|off            开关音效"
        
        MSG_START_ALREADY_RUNNING="服务已运行 (PID: %s)"
        MSG_START_STARTED="护眼服务已启动。"
        MSG_STOP_STOPPED="护眼服务已停止。"
        MSG_STOP_NOT_RUNNING="服务未运行。"
        MSG_KILL_DONE="所有进程已终止，状态已重置。"
        MSG_PAUSE_SPECIFY_DURATION="错误: 请指定时长 (如 1h, 30m)。"
        MSG_PAUSE_PAUSED="服务已暂停 %s (直到 %s)。"
        MSG_PAUSE_ERROR_FORMAT="错误: 时间格式无效。"
        MSG_RESUME_RESUMED="服务已恢复运行。"
        MSG_RESUME_NOT_PAUSED="错误: 服务未处于暂停状态。"
        MSG_PASS_ERROR="错误: 请指定时间。"
        MSG_PASS_SKIPPED="已跳过 %s。"
        MSG_PASS_TRIGGERED="时间已到，立即触发休息。"
        MSG_NOW_MANUAL_RESET="已触发手动休息 (计时器重置)。"
        MSG_NOW_MANUAL_TRIGGERED="已触发手动休息。"
        MSG_NOW_MANUAL_NO_RESET="手动休息结束 (服务未运行)。"
        MSG_NOW_TRIGGERING="正在触发休息..."
        MSG_STATUS_RUNNING="状态: 运行中 (PID: %s)"
        MSG_STATUS_PAUSED_REMAINING="状态: 已暂停 (剩余: %s, 直到 %s)"
        MSG_STATUS_STOPPED="状态: 已停止"
        MSG_STATUS_KILLED="状态: 未运行"
        MSG_STATUS_STOPPED_HINT="提示: 使用 'eye start' 启动服务。"
        MSG_STATUS_CONFIG="配置: 间隔 %s / 远眺 %s"
        MSG_STATUS_LAST_REST="上次休息: %s 前"
        MSG_STATUS_LAST_REST_FROZEN="上次休息: %s 前 (计时冻结)"
        MSG_STATUS_SOUND="音效: Start=[%s] End=[%s] (Switch: %s)"
        MSG_STATUS_LANG="语言: %s"
        MSG_STATUS_SYSTEMD_ACTIVE="Systemd: 已激活"
        MSG_SET_USAGE_HINT="用法: eye set <gap> <look>"
        MSG_SET_UPDATED="配置已更新: 间隔 %s, 远眺 %s"
        MSG_LANG_UPDATED="语言已更新: %s"
        MSG_LANG_INVALID="错误: 无效语言 (支持: English, Chinese)。"
        MSG_AUTOSTART_ON="开机自启已启用。"
        MSG_AUTOSTART_OFF="开机自启已禁用。"
        MSG_AUTOSTART_ERROR="错误: 设置开机自启失败。"
        
        MSG_SOUND_LIST_HEADER="可用音效:"
        MSG_SOUND_LIST_BUILTIN="  [内置]"
        MSG_SOUND_LIST_CUSTOM="  [自定义]"
        MSG_SOUND_LIST_NONE="  (无)"
        MSG_SOUND_LIST_ITEM_NONE="  - none      : 静音"
        MSG_SOUND_LIST_ITEM_DEFAULT="  - default   : 标准"
        MSG_SOUND_LIST_ITEM_BELL="  - bell      : 铃声"
        MSG_SOUND_LIST_ITEM_COMPLETE="  - complete  : 完成"
        MSG_SOUND_LIST_ITEM_SUCCESS="  - success   : 成功"
        MSG_SOUND_LIST_ITEM_ALARM="  - alarm     : 闹钟"
        MSG_SOUND_LIST_ITEM_CAMERA="  - camera    : 快门"
        MSG_SOUND_LIST_ITEM_DEVICE="  - device    : 设备"
        MSG_SOUND_LIST_ITEM_ATTENTION="  - attention : 注意"
        
        MSG_SOUND_PLAY_TAG_REQUIRED="错误: 请指定标签。"
        MSG_SOUND_PLAY_PLAYING="正在播放 [%s] : %s"
        MSG_SOUND_PLAY_MUTE="(静音)"
        MSG_SOUND_PLAY_ERROR="错误: 无法播放文件。"
        MSG_SOUND_SET_UPDATED="音效设置已更新。"
        MSG_SOUND_ADD_USAGE="用法: eye sound add <tag> <path>"
        MSG_SOUND_ADD_ERROR_BUILTIN="错误: '%s' 是内置音效，无法覆盖。"
        MSG_SOUND_ADD_ERROR_FILE="错误: 文件不存在: %s"
        MSG_SOUND_ADD_CONFIRM_REPLACE="标签 '%s' 已存在，覆盖? [y/N] "
        MSG_SOUND_ADD_ADDED="已添加: %s"
        MSG_SOUND_RM_USAGE="用法: eye sound rm <tag>"
        MSG_SOUND_RM_ERROR_BUILTIN="错误: '%s' 是内置音效，无法删除。"
        MSG_SOUND_RM_DELETED="已删除: %s"
        MSG_SOUND_RM_NOT_FOUND="错误: 未找到标签: %s"
        MSG_SOUND_RM_NO_CUSTOM="无自定义配置。"
        MSG_SOUND_ON="音效已开启。"
        MSG_SOUND_OFF="音效已关闭。"
        MSG_SOUND_USAGE="用法: eye sound [list|play|set|add|rm|on|off]"
        
        # Notifications
        MSG_NOTIFY_TITLE_START="护眼提醒"
        MSG_NOTIFY_BODY_START="请远眺 %s！"
        MSG_NOTIFY_TITLE_END="休息结束"
        MSG_NOTIFY_BODY_END="眼睛休息完毕，继续工作吧。"
        MSG_ERROR_INVALID_TIME_FORMAT="错误: 时间格式无效"
        
        # Status Human Readable
        MSG_STATUS_HEADER="护眼状态"
        MSG_STATUS_RUNNING_HUMAN="状态: 运行中 (PID: %s)"
        MSG_STATUS_PAUSED_HUMAN="状态: 暂停中%s"
        MSG_STATUS_STOPPED_HUMAN="状态: 已停止"
        MSG_STATUS_NOT_RUNNING_HUMAN="状态: 未运行"
        MSG_STATUS_LAST_REST_HUMAN="上次休息: %s 前"
        MSG_STATUS_CONFIG_HUMAN="配置: 间隔 %s / 远眺 %s"
        MSG_STATUS_SOUND_HUMAN="音效: %s"
        MSG_STATUS_SYSTEMD_HUMAN="Systemd: 已激活"
        MSG_STATUS_PAUSED_REMAINING_HUMAN=" (剩余暂停: %s)"
        MSG_STATUS_PAUSED_EXPIRED_HUMAN=" (暂停已过期)"
        
    else
        # --- English ---
        MSG_USAGE_HEADER="Usage: eye <command> [args]"
        MSG_USAGE_CORE="Core Commands:"
        MSG_USAGE_CMD_START="  start            Start eye protection service"
        MSG_USAGE_CMD_STOP="  stop             Stop eye protection service"
        MSG_USAGE_CMD_KILL="  kill             Force kill all processes"
        MSG_USAGE_CMD_PAUSE="  pause <time>     Pause service (e.g. 1h, 30m)"
        MSG_USAGE_CMD_RESUME="  resume           Resume service"
        MSG_USAGE_CMD_PASS="  pass <time>      Skip waiting time"
        MSG_USAGE_CMD_STATUS="  status           Show service status"
        MSG_USAGE_CMD_NOW="  now [--reset]    Trigger break immediately"
        MSG_USAGE_CMD_SET="  set <gap> <look> Set intervals (e.g. 20m 20s)"
        MSG_USAGE_CMD_LANG="  language <lang>  Set language (en/zh)"
        MSG_USAGE_CMD_AUTOSTART="  autostart [on|off] Manage autostart"
        MSG_USAGE_AUDIO="Audio Management:"
        MSG_USAGE_CMD_SOUND_LIST="  sound list              List sounds"
        MSG_USAGE_CMD_SOUND_PLAY="  sound play <tag>        Preview sound"
        MSG_USAGE_CMD_SOUND_SET="  sound set <start> <end> Set sounds"
        MSG_USAGE_CMD_SOUND_ADD="  sound add <tag> <path>  Add custom sound"
        MSG_USAGE_CMD_SOUND_RM="  sound rm  <tag>         Remove custom sound"
        MSG_USAGE_CMD_SOUND_SWITCH="  sound on|off            Toggle sound"
        
        MSG_START_ALREADY_RUNNING="Service already running (PID: %s)"
        MSG_START_STARTED="Service started."
        MSG_STOP_STOPPED="Service stopped."
        MSG_STOP_NOT_RUNNING="Service not running."
        MSG_KILL_DONE="Processes killed and state reset."
        MSG_PAUSE_SPECIFY_DURATION="Error: Specify duration (e.g. 1h, 30m)."
        MSG_PAUSE_PAUSED="Paused for %s (until %s)."
        MSG_PAUSE_ERROR_FORMAT="Error: Invalid format."
        MSG_RESUME_RESUMED="Service resumed."
        MSG_RESUME_NOT_PAUSED="Error: Not paused."
        MSG_PASS_ERROR="Error: Specify time."
        MSG_PASS_SKIPPED="Skipped %s."
        MSG_PASS_TRIGGERED="Time limit exceeded, triggering break."
        MSG_NOW_MANUAL_RESET="Manual break triggered (timer reset)."
        MSG_NOW_MANUAL_TRIGGERED="Manual break triggered."
        MSG_NOW_MANUAL_NO_RESET="Manual break finished (service inactive)."
        MSG_NOW_TRIGGERING="Triggering break..."
        MSG_STATUS_RUNNING="Status: Active (running) PID: %s"
        MSG_STATUS_PAUSED_REMAINING="Status: Paused (Remaining: %s, Until: %s)"
        MSG_STATUS_STOPPED="Status: Inactive (stopped)"
        MSG_STATUS_KILLED="Status: Inactive (dead)"
        MSG_STATUS_STOPPED_HINT="Hint: Run 'eye start' to enable."
        MSG_STATUS_CONFIG="Config: Gap %s / Look %s"
        MSG_STATUS_LAST_REST="Last rest: %s ago"
        MSG_STATUS_LAST_REST_FROZEN="Last rest: %s ago (Frozen)"
        MSG_STATUS_SOUND="Sound: Start=[%s] End=[%s] (Switch: %s)"
        MSG_STATUS_LANG="Language: %s"
        MSG_STATUS_SYSTEMD_ACTIVE="Systemd: Active"
        MSG_SET_USAGE_HINT="Usage: eye set <gap> <look>"
        MSG_SET_UPDATED="Config updated: Gap %s, Look %s"
        MSG_LANG_UPDATED="Language updated: %s"
        MSG_LANG_INVALID="Error: Invalid language (en/zh)."
        MSG_AUTOSTART_ON="Autostart enabled."
        MSG_AUTOSTART_OFF="Autostart disabled."
        MSG_AUTOSTART_ERROR="Error: Failed to enable autostart."
        
        MSG_SOUND_LIST_HEADER="Available Sounds:"
        MSG_SOUND_LIST_BUILTIN="  [Built-in]"
        MSG_SOUND_LIST_CUSTOM="  [Custom]"
        MSG_SOUND_LIST_NONE="  (None)"
        MSG_SOUND_LIST_ITEM_NONE="  - none      : Mute"
        MSG_SOUND_LIST_ITEM_DEFAULT="  - default   : Standard"
        MSG_SOUND_LIST_ITEM_BELL="  - bell      : Bell"
        MSG_SOUND_LIST_ITEM_COMPLETE="  - complete  : Task complete"
        MSG_SOUND_LIST_ITEM_SUCCESS="  - success   : Success"
        MSG_SOUND_LIST_ITEM_ALARM="  - alarm     : Alarm clock"
        MSG_SOUND_LIST_ITEM_CAMERA="  - camera    : Shutter"
        MSG_SOUND_LIST_ITEM_DEVICE="  - device    : Device"
        MSG_SOUND_LIST_ITEM_ATTENTION="  - attention : Attention"
        
        MSG_SOUND_PLAY_TAG_REQUIRED="Error: Please specify a tag."
        MSG_SOUND_PLAY_PLAYING="Playing [%s] : %s"
        MSG_SOUND_PLAY_MUTE="(Muted)"
        MSG_SOUND_PLAY_ERROR="Error: Cannot play file."
        MSG_SOUND_SET_UPDATED="Sounds updated."
        MSG_SOUND_ADD_USAGE="Usage: eye sound add <tag> <path>"
        MSG_SOUND_ADD_ERROR_BUILTIN="Error: '%s' is built-in."
        MSG_SOUND_ADD_ERROR_FILE="Error: File not found: %s"
        MSG_SOUND_ADD_CONFIRM_REPLACE="Tag '%s' exists, replace? [y/N] "
        MSG_SOUND_ADD_ADDED="Added: %s"
        MSG_SOUND_RM_USAGE="Usage: eye sound rm <tag>"
        MSG_SOUND_RM_ERROR_BUILTIN="Error: Cannot remove built-in sound."
        MSG_SOUND_RM_DELETED="Deleted: %s"
        MSG_SOUND_RM_NOT_FOUND="Error: Tag not found: %s"
        MSG_SOUND_RM_NO_CUSTOM="No custom configuration."
        MSG_SOUND_ON="Sound enabled."
        MSG_SOUND_OFF="Sound disabled."
        MSG_SOUND_USAGE="Usage: eye sound [list|play|set|add|rm|on|off]"
        
        # Notifications
        MSG_NOTIFY_TITLE_START="Eye Protection"
        MSG_NOTIFY_BODY_START="Look away for %s!"
        MSG_NOTIFY_TITLE_END="Break Ended"
        MSG_NOTIFY_BODY_END="Eyes rested. Keep going!"
        MSG_ERROR_INVALID_TIME_FORMAT="Error: Invalid time format"
        
        # Status Human Readable
        MSG_STATUS_HEADER="Eye Protection Status"
        MSG_STATUS_RUNNING_HUMAN="Status: Running (PID: %s)"
        MSG_STATUS_PAUSED_HUMAN="Status: Paused%s"
        MSG_STATUS_STOPPED_HUMAN="Status: Stopped"
        MSG_STATUS_NOT_RUNNING_HUMAN="Status: Not Running"
        MSG_STATUS_LAST_REST_HUMAN="Last Rest: %s ago"
        MSG_STATUS_CONFIG_HUMAN="Configuration: Interval %s / Look-away %s"
        MSG_STATUS_SOUND_HUMAN="Sound: %s"
        MSG_STATUS_SYSTEMD_HUMAN="Systemd: Active"
        MSG_STATUS_PAUSED_REMAINING_HUMAN=" (Paused for %s remaining)"
        MSG_STATUS_PAUSED_EXPIRED_HUMAN=" (Pause expired)"
    fi
}
